<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>
    <body>
        <h1> <%= graphTitle %> </h1>
        <select>
          <option value="1">High</option>
          <option value="0">Low</option>
          <option value="2">Open</option>
          <option value="4">Close</option>
          <option value="3">Last</option>
          <option value="7">Total Trade Quantity</option>
          <option value="6">Turnover In Lakhs</option>
        </select>
        <div id="plotGraph" style="width:100%; height:90vh; border:black solid 1px"></div>

        <script>
            function plotAfterProperty(propIndex) {
                var y_axis = Object.keys(rows[0])[propIndex];
                var data =
                [{
                    // set the x-axis data
                    x:  rows.map(function(row) {
                            return JSON.stringify(row[x_axis].split("T")[0]);
                        }),
                    // set the y-axis data
                    y:  rows.map(function(row) {
                            return JSON.stringify(row[y_axis]);
                        })
                }];

                // Layout Styling
                var layout = {
                    xaxis: {
                        title: 'Date',
                        tickformat: "%B, %Y"
                    },
                    yaxis: {
                        title: y_axis,
                        type: 'log'
                    },
                    margin: {
                        t: 20
                    },
                    hovermode: 'closest',
                    autosize: true,
                    width: 1275,
                    height: 600,
                    margin: {
                        l: 75, r: 75, b: 100, t: 50, pad: 0
                    }
                }
                Plotly.newPlot('plotGraph', data, layout);
            }

            var rows = <%-JSON.stringify(data)%>;
            var x_axis = Object.keys(rows[0])[5];

            plotAfterProperty(1);
            document.querySelector('select').addEventListener("change",  function() {
                  plotAfterProperty(this.value);
            });

        </script>
    </body>
</html>
